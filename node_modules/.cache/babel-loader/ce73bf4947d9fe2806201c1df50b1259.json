{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar util_1 = require(\"@firebase/util\");\n\nvar Change_1 = require(\"./Change\");\n\nvar util_2 = require(\"@firebase/util\");\n/**\n * @constructor\n */\n\n\nvar ChildChangeAccumulator =\n/** @class */\nfunction () {\n  function ChildChangeAccumulator() {\n    this.changeMap_ = {};\n  }\n  /**\n   * @param {!Change} change\n   */\n\n\n  ChildChangeAccumulator.prototype.trackChildChange = function (change) {\n    var type = change.type;\n    var childKey\n    /** @type {!string} */\n    = change.childName;\n    util_2.assert(type == Change_1.Change.CHILD_ADDED || type == Change_1.Change.CHILD_CHANGED || type == Change_1.Change.CHILD_REMOVED, 'Only child changes supported for tracking');\n    util_2.assert(childKey !== '.priority', 'Only non-priority child changes can be tracked.');\n    var oldChange = util_1.safeGet(this.changeMap_, childKey);\n\n    if (oldChange) {\n      var oldType = oldChange.type;\n\n      if (type == Change_1.Change.CHILD_ADDED && oldType == Change_1.Change.CHILD_REMOVED) {\n        this.changeMap_[childKey] = Change_1.Change.childChangedChange(childKey, change.snapshotNode, oldChange.snapshotNode);\n      } else if (type == Change_1.Change.CHILD_REMOVED && oldType == Change_1.Change.CHILD_ADDED) {\n        delete this.changeMap_[childKey];\n      } else if (type == Change_1.Change.CHILD_REMOVED && oldType == Change_1.Change.CHILD_CHANGED) {\n        this.changeMap_[childKey] = Change_1.Change.childRemovedChange(childKey, oldChange.oldSnap);\n      } else if (type == Change_1.Change.CHILD_CHANGED && oldType == Change_1.Change.CHILD_ADDED) {\n        this.changeMap_[childKey] = Change_1.Change.childAddedChange(childKey, change.snapshotNode);\n      } else if (type == Change_1.Change.CHILD_CHANGED && oldType == Change_1.Change.CHILD_CHANGED) {\n        this.changeMap_[childKey] = Change_1.Change.childChangedChange(childKey, change.snapshotNode, oldChange.oldSnap);\n      } else {\n        throw util_2.assertionError('Illegal combination of changes: ' + change + ' occurred after ' + oldChange);\n      }\n    } else {\n      this.changeMap_[childKey] = change;\n    }\n  };\n  /**\n   * @return {!Array.<!Change>}\n   */\n\n\n  ChildChangeAccumulator.prototype.getChanges = function () {\n    return util_1.getValues(this.changeMap_);\n  };\n\n  return ChildChangeAccumulator;\n}();\n\nexports.ChildChangeAccumulator = ChildChangeAccumulator;","map":{"version":3,"sources":["../src/core/view/ChildChangeAccumulator.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getValues, safeGet } from '@firebase/util';\nimport { Change } from './Change';\nimport { assert, assertionError } from '@firebase/util';\n\n/**\n * @constructor\n */\nexport class ChildChangeAccumulator {\n  private changeMap_: { [k: string]: Change } = {};\n\n  /**\n   * @param {!Change} change\n   */\n  trackChildChange(change: Change) {\n    const type = change.type;\n    const childKey /** @type {!string} */ = change.childName;\n    assert(\n      type == Change.CHILD_ADDED ||\n        type == Change.CHILD_CHANGED ||\n        type == Change.CHILD_REMOVED,\n      'Only child changes supported for tracking'\n    );\n    assert(\n      childKey !== '.priority',\n      'Only non-priority child changes can be tracked.'\n    );\n    const oldChange = safeGet(this.changeMap_, childKey) as Change;\n    if (oldChange) {\n      const oldType = oldChange.type;\n      if (type == Change.CHILD_ADDED && oldType == Change.CHILD_REMOVED) {\n        this.changeMap_[childKey] = Change.childChangedChange(\n          childKey,\n          change.snapshotNode,\n          oldChange.snapshotNode\n        );\n      } else if (\n        type == Change.CHILD_REMOVED &&\n        oldType == Change.CHILD_ADDED\n      ) {\n        delete this.changeMap_[childKey];\n      } else if (\n        type == Change.CHILD_REMOVED &&\n        oldType == Change.CHILD_CHANGED\n      ) {\n        this.changeMap_[childKey] = Change.childRemovedChange(\n          childKey,\n          oldChange.oldSnap\n        );\n      } else if (\n        type == Change.CHILD_CHANGED &&\n        oldType == Change.CHILD_ADDED\n      ) {\n        this.changeMap_[childKey] = Change.childAddedChange(\n          childKey,\n          change.snapshotNode\n        );\n      } else if (\n        type == Change.CHILD_CHANGED &&\n        oldType == Change.CHILD_CHANGED\n      ) {\n        this.changeMap_[childKey] = Change.childChangedChange(\n          childKey,\n          change.snapshotNode,\n          oldChange.oldSnap\n        );\n      } else {\n        throw assertionError(\n          'Illegal combination of changes: ' +\n            change +\n            ' occurred after ' +\n            oldChange\n        );\n      }\n    } else {\n      this.changeMap_[childKey] = change;\n    }\n  }\n\n  /**\n   * @return {!Array.<!Change>}\n   */\n  getChanges(): Change[] {\n    return getValues(this.changeMap_);\n  }\n}\n"]},"metadata":{},"sourceType":"script"}