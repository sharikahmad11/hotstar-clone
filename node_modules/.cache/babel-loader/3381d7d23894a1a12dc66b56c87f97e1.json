{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar EventEmitter_1 = require(\"./EventEmitter\");\n\nvar util_1 = require(\"@firebase/util\");\n/**\n * @extends {EventEmitter}\n */\n\n\nvar VisibilityMonitor =\n/** @class */\nfunction (_super) {\n  __extends(VisibilityMonitor, _super);\n\n  function VisibilityMonitor() {\n    var _this = _super.call(this, ['visible']) || this;\n\n    var hidden;\n    var visibilityChange;\n\n    if (typeof document !== 'undefined' && typeof document.addEventListener !== 'undefined') {\n      if (typeof document['hidden'] !== 'undefined') {\n        // Opera 12.10 and Firefox 18 and later support\n        visibilityChange = 'visibilitychange';\n        hidden = 'hidden';\n      } else if (typeof document['mozHidden'] !== 'undefined') {\n        visibilityChange = 'mozvisibilitychange';\n        hidden = 'mozHidden';\n      } else if (typeof document['msHidden'] !== 'undefined') {\n        visibilityChange = 'msvisibilitychange';\n        hidden = 'msHidden';\n      } else if (typeof document['webkitHidden'] !== 'undefined') {\n        visibilityChange = 'webkitvisibilitychange';\n        hidden = 'webkitHidden';\n      }\n    } // Initially, we always assume we are visible. This ensures that in browsers\n    // without page visibility support or in cases where we are never visible\n    // (e.g. chrome extension), we act as if we are visible, i.e. don't delay\n    // reconnects\n\n\n    _this.visible_ = true;\n\n    if (visibilityChange) {\n      document.addEventListener(visibilityChange, function () {\n        var visible = !document[hidden];\n\n        if (visible !== _this.visible_) {\n          _this.visible_ = visible;\n\n          _this.trigger('visible', visible);\n        }\n      }, false);\n    }\n\n    return _this;\n  }\n\n  VisibilityMonitor.getInstance = function () {\n    return new VisibilityMonitor();\n  };\n  /**\n   * @param {!string} eventType\n   * @return {Array.<boolean>}\n   */\n\n\n  VisibilityMonitor.prototype.getInitialEvent = function (eventType) {\n    util_1.assert(eventType === 'visible', 'Unknown event type: ' + eventType);\n    return [this.visible_];\n  };\n\n  return VisibilityMonitor;\n}(EventEmitter_1.EventEmitter);\n\nexports.VisibilityMonitor = VisibilityMonitor;","map":{"version":3,"sources":["../src/core/util/VisibilityMonitor.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;AAcG;;;;;;;;;;;;;;;;;;;;;;;;;;AAEH,IAAA,cAAA,GAAA,OAAA,CAAA,gBAAA,CAAA;;AACA,IAAA,MAAA,GAAA,OAAA,CAAA,gBAAA,CAAA;AAIA;;AAEG;;;AACH,IAAA,iBAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAAuC,EAAA,SAAA,CAAA,iBAAA,EAAA,MAAA,CAAA;;AAOrC,WAAA,iBAAA,GAAA;AAAA,QAAA,KAAA,GACE,MAAA,CAAA,IAAA,CAAA,IAAA,EAAM,CAAC,SAAD,CAAN,KAAkB,IADpB;;AAEE,QAAI,MAAJ;AACA,QAAI,gBAAJ;;AACA,QACE,OAAO,QAAP,KAAoB,WAApB,IACA,OAAO,QAAQ,CAAC,gBAAhB,KAAqC,WAFvC,EAGE;AACA,UAAI,OAAO,QAAQ,CAAC,QAAD,CAAf,KAA8B,WAAlC,EAA+C;AAC7C;AACA,QAAA,gBAAgB,GAAG,kBAAnB;AACA,QAAA,MAAM,GAAG,QAAT;AACD,OAJD,MAIO,IAAI,OAAO,QAAQ,CAAC,WAAD,CAAf,KAAiC,WAArC,EAAkD;AACvD,QAAA,gBAAgB,GAAG,qBAAnB;AACA,QAAA,MAAM,GAAG,WAAT;AACD,OAHM,MAGA,IAAI,OAAO,QAAQ,CAAC,UAAD,CAAf,KAAgC,WAApC,EAAiD;AACtD,QAAA,gBAAgB,GAAG,oBAAnB;AACA,QAAA,MAAM,GAAG,UAAT;AACD,OAHM,MAGA,IAAI,OAAO,QAAQ,CAAC,cAAD,CAAf,KAAoC,WAAxC,EAAqD;AAC1D,QAAA,gBAAgB,GAAG,wBAAnB;AACA,QAAA,MAAM,GAAG,cAAT;AACD;AACF,KAtBH,CAwBE;AACA;AACA;AACA;;;AACA,IAAA,KAAI,CAAC,QAAL,GAAgB,IAAhB;;AAEA,QAAI,gBAAJ,EAAsB;AACpB,MAAA,QAAQ,CAAC,gBAAT,CACE,gBADF,EAEE,YAAA;AACE,YAAM,OAAO,GAAG,CAAC,QAAQ,CAAC,MAAD,CAAzB;;AACA,YAAI,OAAO,KAAK,KAAI,CAAC,QAArB,EAA+B;AAC7B,UAAA,KAAI,CAAC,QAAL,GAAgB,OAAhB;;AACA,UAAA,KAAI,CAAC,OAAL,CAAa,SAAb,EAAwB,OAAxB;AACD;AACF,OARH,EASE,KATF;AAWD;;;AACF;;AA/CM,EAAA,iBAAA,CAAA,WAAA,GAAP,YAAA;AACE,WAAO,IAAI,iBAAJ,EAAP;AACD,GAFM;AAiDP;;;AAGG;;;AACH,EAAA,iBAAA,CAAA,SAAA,CAAA,eAAA,GAAA,UAAgB,SAAhB,EAAiC;AAC/B,IAAA,MAAA,CAAA,MAAA,CAAO,SAAS,KAAK,SAArB,EAAgC,yBAAyB,SAAzD;AACA,WAAO,CAAC,KAAK,QAAN,CAAP;AACD,GAHD;;AAIF,SAAA,iBAAA;AAAC,CA5DD,CAAuC,cAAA,CAAA,YAAvC,CAAA;;AAAa,OAAA,CAAA,iBAAA,GAAA,iBAAA","sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from './EventEmitter';\nimport { assert } from '@firebase/util';\n\ndeclare const document: any;\n\n/**\n * @extends {EventEmitter}\n */\nexport class VisibilityMonitor extends EventEmitter {\n  private visible_: boolean;\n\n  static getInstance() {\n    return new VisibilityMonitor();\n  }\n\n  constructor() {\n    super(['visible']);\n    let hidden: string;\n    let visibilityChange: string;\n    if (\n      typeof document !== 'undefined' &&\n      typeof document.addEventListener !== 'undefined'\n    ) {\n      if (typeof document['hidden'] !== 'undefined') {\n        // Opera 12.10 and Firefox 18 and later support\n        visibilityChange = 'visibilitychange';\n        hidden = 'hidden';\n      } else if (typeof document['mozHidden'] !== 'undefined') {\n        visibilityChange = 'mozvisibilitychange';\n        hidden = 'mozHidden';\n      } else if (typeof document['msHidden'] !== 'undefined') {\n        visibilityChange = 'msvisibilitychange';\n        hidden = 'msHidden';\n      } else if (typeof document['webkitHidden'] !== 'undefined') {\n        visibilityChange = 'webkitvisibilitychange';\n        hidden = 'webkitHidden';\n      }\n    }\n\n    // Initially, we always assume we are visible. This ensures that in browsers\n    // without page visibility support or in cases where we are never visible\n    // (e.g. chrome extension), we act as if we are visible, i.e. don't delay\n    // reconnects\n    this.visible_ = true;\n\n    if (visibilityChange) {\n      document.addEventListener(\n        visibilityChange,\n        () => {\n          const visible = !document[hidden];\n          if (visible !== this.visible_) {\n            this.visible_ = visible;\n            this.trigger('visible', visible);\n          }\n        },\n        false\n      );\n    }\n  }\n\n  /**\n   * @param {!string} eventType\n   * @return {Array.<boolean>}\n   */\n  getInitialEvent(eventType: string): boolean[] {\n    assert(eventType === 'visible', 'Unknown event type: ' + eventType);\n    return [this.visible_];\n  }\n}\n"]},"metadata":{},"sourceType":"script"}